<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Congressional Action Prediction Tool</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				min-height: 100vh;
				color: #333;
			}

			.container {
				max-width: 1200px;
				margin: 0 auto;
				padding: 20px;
			}

			.header {
				text-align: center;
				color: white;
				margin-bottom: 30px;
			}

			.header h1 {
				font-size: 2.5em;
				margin-bottom: 10px;
				text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
			}

			.header p {
				font-size: 1.1em;
				opacity: 0.9;
			}

			.main-content {
				display: grid;
				grid-template-columns: 1fr 2fr;
				gap: 20px;
				margin-bottom: 20px;
			}

			.sequence-panel,
			.predictions-panel {
				background: white;
				border-radius: 12px;
				padding: 25px;
				box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
				backdrop-filter: blur(4px);
				border: 1px solid rgba(255, 255, 255, 0.18);
			}

			.sequence-panel h2,
			.predictions-panel h2 {
				color: #2c3e50;
				margin-bottom: 20px;
				font-size: 1.4em;
				border-bottom: 2px solid #3498db;
				padding-bottom: 10px;
			}

			.sequence-display {
				min-height: 200px;
				background: #f8f9fa;
				border: 2px dashed #dee2e6;
				border-radius: 8px;
				padding: 15px;
				margin-bottom: 20px;
			}

			.sequence-item {
				background: linear-gradient(135deg, #74b9ff, #0984e3);
				color: white;
				padding: 8px 12px;
				margin: 5px 0;
				border-radius: 6px;
				font-size: 0.9em;
				box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
				transition: transform 0.2s ease;
			}

			.sequence-item:hover {
				transform: translateY(-1px);
			}

			.sequence-item .step-number {
				font-weight: bold;
				background: rgba(255, 255, 255, 0.2);
				padding: 2px 6px;
				border-radius: 4px;
				margin-right: 8px;
			}

			.controls {
				display: flex;
				gap: 10px;
				margin-bottom: 20px;
			}

			.btn {
				padding: 10px 20px;
				border: none;
				border-radius: 6px;
				cursor: pointer;
				font-weight: 600;
				transition: all 0.3s ease;
				font-size: 0.9em;
			}

			.btn-primary {
				background: linear-gradient(135deg, #667eea, #764ba2);
				color: white;
			}

			.btn-secondary {
				background: #95a5a6;
				color: white;
			}

			.btn:hover {
				transform: translateY(-2px);
				box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
			}

			.btn:disabled {
				opacity: 0.6;
				cursor: not-allowed;
				transform: none;
			}

			.search-container {
				margin-bottom: 20px;
			}

			.search-input {
				width: 100%;
				padding: 12px;
				border: 2px solid #ddd;
				border-radius: 8px;
				font-size: 1em;
				transition: border-color 0.3s ease;
			}

			.search-input:focus {
				outline: none;
				border-color: #667eea;
				box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
			}

			.predictions-container {
				max-height: 600px;
				overflow-y: auto;
			}

			.prediction-item {
				display: flex;
				justify-content: space-between;
				align-items: center;
				padding: 15px;
				border: 1px solid #e9ecef;
				border-radius: 8px;
				margin-bottom: 10px;
				cursor: pointer;
				transition: all 0.3s ease;
				background: linear-gradient(135deg, #f8f9fa, #ffffff);
			}

			.prediction-item:hover {
				border-color: #667eea;
				transform: translateX(5px);
				box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
			}

			.prediction-description {
				flex: 1;
				font-weight: 500;
				color: #2c3e50;
			}

			.prediction-probability {
				background: linear-gradient(135deg, #667eea, #764ba2);
				color: white;
				padding: 5px 12px;
				border-radius: 20px;
				font-weight: bold;
				font-size: 0.9em;
				min-width: 60px;
				text-align: center;
			}

			.stats {
				background: white;
				border-radius: 12px;
				padding: 20px;
				box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
				backdrop-filter: blur(4px);
				border: 1px solid rgba(255, 255, 255, 0.18);
			}

			.stats-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
				gap: 20px;
			}

			.stat-item {
				text-align: center;
				padding: 15px;
				background: linear-gradient(135deg, #f8f9fa, #ffffff);
				border-radius: 8px;
				border: 1px solid #e9ecef;
			}

			.stat-number {
				font-size: 2em;
				font-weight: bold;
				color: #667eea;
			}

			.stat-label {
				color: #6c757d;
				font-size: 0.9em;
				margin-top: 5px;
			}

			.loading {
				text-align: center;
				padding: 20px;
				color: #6c757d;
			}

			.spinner {
				border: 4px solid #f3f3f3;
				border-top: 4px solid #667eea;
				border-radius: 50%;
				width: 30px;
				height: 30px;
				animation: spin 1s linear infinite;
				margin: 0 auto 10px;
			}

			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}

			.error {
				background: #fee;
				border: 1px solid #fcc;
				color: #c33;
				padding: 15px;
				border-radius: 8px;
				margin-bottom: 20px;
			}

			@media (max-width: 768px) {
				.main-content {
					grid-template-columns: 1fr;
				}

				.stats-grid {
					grid-template-columns: 1fr 1fr;
				}

				.controls {
					flex-direction: column;
				}
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="header">
				<h1>Congressional Action Prediction Tool</h1>
				<p>
					Explore sequential predictions of congressional actions
					using machine learning
				</p>
			</div>

			<div class="main-content">
				<div class="sequence-panel">
					<h2>Action Sequence</h2>
					<div class="sequence-display" id="sequenceDisplay">
						<p
							style="
								color: #6c757d;
								text-align: center;
								margin-top: 80px;
							"
						>
							No actions selected yet. Choose a predicted action
							to start building the sequence.
						</p>
					</div>
					<div class="controls">
						<button
							class="btn btn-secondary"
							id="undoBtn"
							onclick="undoLastAction()"
							disabled
						>
							Undo Last Action
						</button>
						<button
							class="btn btn-secondary"
							id="resetBtn"
							onclick="resetSequence()"
						>
							Reset Sequence
						</button>
					</div>
				</div>

				<div class="predictions-panel">
					<h2>Predicted Next Actions</h2>
					<div class="search-container">
						<input
							type="text"
							id="searchInput"
							class="search-input"
							placeholder="Search actions..."
							onkeyup="debounceSearch()"
						/>
					</div>
					<div
						id="predictionsContainer"
						class="predictions-container"
					>
						<div class="loading">
							<div class="spinner"></div>
							Loading initial predictions...
						</div>
					</div>
				</div>
			</div>

			<div class="stats">
				<div class="stats-grid">
					<div class="stat-item">
						<div class="stat-number" id="sequenceLength">0</div>
						<div class="stat-label">Actions in Sequence</div>
					</div>
					<div class="stat-item">
						<div class="stat-number" id="totalPredictions">0</div>
						<div class="stat-label">Total Possible Actions</div>
					</div>
					<div class="stat-item">
						<div class="stat-number" id="filteredPredictions">
							0
						</div>
						<div class="stat-label">Filtered Results</div>
					</div>
					<div class="stat-item">
						<div class="stat-number" id="topProbability">0%</div>
						<div class="stat-label">Highest Probability</div>
					</div>
				</div>
			</div>
		</div>

		<script>
			let actionSequence = [];
			let allPredictions = [];
			let searchTimeout;

			// Initialize the app
			document.addEventListener("DOMContentLoaded", function () {
				loadPredictions();
			});

			// Load predictions from the server
			async function loadPredictions(searchQuery = "") {
				try {
					const response = await fetch("/predict", {
						method: "POST",
						headers: {
							"Content-Type": "application/json",
						},
						body: JSON.stringify({
							sequence: actionSequence,
							search: searchQuery,
						}),
					});

					const data = await response.json();

					if (data.error) {
						showError(data.error);
						return;
					}

					allPredictions = data.predictions;
					displayPredictions(data.predictions);
					updateStats(data);
				} catch (error) {
					showError("Failed to load predictions: " + error.message);
				}
			}

			// Display predictions in the UI
			function displayPredictions(predictions) {
				const container = document.getElementById(
					"predictionsContainer"
				);

				if (predictions.length === 0) {
					container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #6c757d;">
                        No actions found matching your search.
                    </div>
                `;
					return;
				}

				container.innerHTML = predictions
					.map(
						(pred) => `
                <div class="prediction-item" onclick="selectAction(${
					pred.action_id
				}, '${pred.description.replace(/'/g, "\\'")}')">
                    <div class="prediction-description">${
						pred.description
					}</div>
                    <div class="prediction-probability">${
						pred.probability
					}%</div>
                </div>
            `
					)
					.join("");
			}

			// Select an action and add it to the sequence
			async function selectAction(actionId, description) {
				actionSequence.push(description);
				updateSequenceDisplay();

				// Show loading state
				document.getElementById("predictionsContainer").innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    Predicting next actions...
                </div>
            `;

				// Clear search
				document.getElementById("searchInput").value = "";

				// Load new predictions
				await loadPredictions();

				// Update controls
				document.getElementById("undoBtn").disabled = false;
			}

			// Update the sequence display
			function updateSequenceDisplay() {
				const container = document.getElementById("sequenceDisplay");

				if (actionSequence.length === 0) {
					container.innerHTML = `
                    <p style="color: #6c757d; text-align: center; margin-top: 80px;">
                        No actions selected yet. Choose a predicted action to start building the sequence.
                    </p>
                `;
					return;
				}

				// For demo purposes, we'll use placeholder descriptions
				// In a real implementation, you'd fetch the actual descriptions
				const sequenceHtml = actionSequence
					.map(
						(description, index) => `
                <div class="sequence-item">
                    <span class="step-number">${index + 1}</span>
                    ${description}
                </div>
            `
					)
					.join("");

				container.innerHTML = sequenceHtml;
			}

			// Undo the last action
			async function undoLastAction() {
				if (actionSequence.length === 0) return;

				actionSequence.pop();
				updateSequenceDisplay();

				if (actionSequence.length === 0) {
					document.getElementById("undoBtn").disabled = true;
				}

				// Clear search
				document.getElementById("searchInput").value = "";

				// Reload predictions
				await loadPredictions();
			}

			// Reset the entire sequence
			async function resetSequence() {
				actionSequence = [];
				updateSequenceDisplay();
				document.getElementById("undoBtn").disabled = true;

				// Clear search
				document.getElementById("searchInput").value = "";

				// Reload predictions
				await loadPredictions();
			}

			// Debounced search function
			function debounceSearch() {
				clearTimeout(searchTimeout);
				searchTimeout = setTimeout(() => {
					const query = document.getElementById("searchInput").value;
					loadPredictions(query);
				}, 300);
			}

			// Update statistics display
			function updateStats(data) {
				document.getElementById("sequenceLength").textContent =
					actionSequence.length;
				document.getElementById("totalPredictions").textContent =
					data.total_actions;
				document.getElementById("filteredPredictions").textContent =
					data.predictions.length;

				const topProb =
					data.predictions.length > 0
						? data.predictions[0].probability
						: 0;
				document.getElementById("topProbability").textContent =
					topProb + "%";
			}

			// Show error message
			function showError(message) {
				const container = document.getElementById(
					"predictionsContainer"
				);
				container.innerHTML = `
                <div class="error">
                    <strong>Error:</strong> ${message}
                </div>
            `;
			}
		</script>
	</body>
</html>
